---
layout: post
title: "编码规范"
data: 2019-9-3 15:15
categories:  C/C++
---

## 总体原则
* 清晰，易于维护、易于重构
* 简洁，易于理解，并且易于实现
* 风格统一，代码整体风格保持统一
* 通用性，遵循业界通用的编程规范

## 目录结构
**建议将工程按照功能模块划分子目录，子目录再定义头文件和源文件目录**

## 头文件
### 设计原则
* 为了防止头文件被重复引用，应当用ifndef/define/endif结构产生预处理块
* 用 #include <filename.h> 格式来引用标准库的头文件，用 #include “filename.h” 引用非标准库的头文件
* 头文件应当职责单一
* **头文件中适合放置接口的声明，不适合放置实现**
* **不要在头文件中定义变量**
* 建议每一个.c文件应有一个同名.h文件，用于声明需要对外公开的接口
* **一个模块通常包含多个.c文件，建议放在同一个目录下，目录名即为模块名；如果一个模块包含多个子模块，则建议每一个子模块提供一个对外的.h，文件名为子模块名**
* 禁止循环依赖
* 禁止包含用不到的头文件
* 只能通过.h使用extern
* 禁止在extern "C" 包含头文件

### 版权声明
* 头文件版权声明一致，放在头文件置顶位置
* 如果提交的代码是在开源软件基础上修改所编写或衍生的代码，请遵循开源许可协议要求，并且已完成履行被修改软件的许可证义务

## 函数
* **重复代码应该尽可能提炼成函数**
* 避免函数过长，**新增函数不超过40-50行**
* 避免函数的代码块嵌套过深
* **函数应避免使用全局变量、静态局部变量和 I/O 操作，不可避免的地方应集中使用**
* 设计高扇入，合理扇出（小于7）的函数
* **函数不变参数使用const**
* 函数参数不超过5个
* **除打印类函数外，不要使用可变长参函数**
* **在源文件范围内声明和定义的所有函数，除非外部可见 ，都应增加static关键字**
* **不建议使用递归函数调用**

## 标识符
* **unix like风格，单词小写，用下划线连接，例如：text_mutex。全局变量大小写混合方式，例如：GetErrMsg**
* 不使用缩写和汉语拼音
* 避免名字中出现数字编号
* 标识符前不应添加模块、项目、产品、部门的名称作为前缀
* **全局变量应增加”g_“前缀，静态增加”s_“前缀**
* 类型名加前缀”P_“，全大写，下划线连接
* 禁止单字节变量，除局部循环使用
* 不建议使用匈牙利命名法
* **数值和字符串等等常量的定义，建议采用全大写字母，使用下划线”_“连接**
* **除了头文件或编译开关等特殊表示定义，宏定义不能使用下划线”_“开头和结尾**
* 函数参数使用unix like风格

## 变量
* **一个变量只有一个功能，不要把一个变量用作多种用途**
* 防止局部变量和全局变量同名
* **不用或者少用全局变量**
* **在首次使用前初始化变量**
* **使用面向接口编程思想，通过API访问数据；若本模块数据需要对外开放，应提供接口函数来设置、获取**
* 初始化变量离使用地方越近越好
* 明确全局变量初始化顺序
* **尽量减少没有必要的数据类型默认转换与强制转换**

## 宏、常量
* **宏定义表达式时，使用完备的括号**
* 将宏定义的多条表达式放在大括号中
* **不允许直接使用魔鬼数字**
* 除非必要，应尽可能使用函数代替宏,除了do-while 结构
* **常量建议使用const代替宏**

## 注释
* 注释格式可被doxygen工具识别，注释内容可以为中文
* 注释风格要统一，注释内容要清楚、明了、含义准确、防止注释二义性
* 在代码的功能、意图层次上进行注释，即**注释解释代码难以表达的意图，而不是仅仅重复描述代码**
* **函数声明处注释函数的功能、性能即用法，包括输入输出函数、函数返回值、可重入的要求等；定义处详细描述函数功能和实现要点，如实现的简要步骤、实现的理由、设计约束等**
* **对于函数名能够自解释的，可以不写注释。**
* **全局变量要有详细的注释，包括对其功能、取值范围以及存取时注意事项等的说明**
* **注释应放在起代码上方相邻位置或右方**
* 避免在注释中使用缩写，除非时业界通用或子系统内标准化的缩写
* **文件头部要注释，建议注释列出：版权说明、版本号、生成日期、作者姓名、功能说明、与其他文件的关系、修改日志等，头文件的注释还应有函数功能的简要说明。**
。

## 排版与格式
* 程序块采用缩进风格编写，**每级缩进为4格空格**
* **相对独立的程序块之间、变量说明之后必须加空行**
* 一条语句不能过长 如必能拆分需要分行写
* 一行只写一条语句
* if、for、do、while、case、switch、default等语句独占一行
* 源程序中关系较为紧密的代码尽可能相邻
* 注释符(包括„/*‟„//‟„*/‟)与注释内容之间要用一个空格进行分隔
* **定义函数时左花括号”{“单独占一行，其他的`if`、`while`、`for`等语句建议紧随其后**
* **组成switch、while、do...while 或for 结构体的语句应该是复合语句。即使该复合语句只包含一条语句也要扩在{}里**
* **const、virtual、inline、case 等关键字之后至少要留一个空格；函数名之后不要留空格，紧跟左括号‘（’，以与关键字区别；赋值操作符、比较操作符、算术操作符、逻辑操作符、位域操作符，如“=”、“+=” “>=”、“<=”、“+”、“*”、“%”、“&&”、“||”、“<<”,“^”等二元操作符的前后应当加空格；一元操作符如“!”、“~”、“++”、“--”、“&”（地址运算符）等前后不加空格**
* 建议函数内部变量定义和函数语句之间空三行

## 可移植性
* 不使用与硬件或操作系统关系很大的语句，而使用建议的标准语句，以提高软件的可移植性和可重用性

## 业界编程规范
* C语言编程规范参考资料较多，大家可以自行了解，不再赘述。

## 编写示例

### 缩写及含义
```c
@file             文件名
@author           作者
@brief            简要说明
@param           用于函数说明中，后面接参数名字，然后再接关于该参数的说明
@return           对函数返回值进行说明
@note             注解信息
@attention                  注意信息
@warning          警告信息
@see              表示交叉参考
```

### 头文件

```c
/**
* Copyright (c) 2001,xxxx Inc
* All rights reserved.
* 
* @file      filename.h
* @brief   见配置管理计划书
* @author
* @version  V3.5.0
* @date    2009/10/16
*
* @par     Modification:添加函数，支持********<br>
*                     History
*          Version：V3.0.1 <br>
*          Author：***<br>
*          Modification:添加函数，支持********<br>
*          Version：V3.0.0 <br>
*          Author：***<br>
*          Modification:添加函数，支持********<br>
*
* @attention
*/
/* Define to prevent recursive inclusion -------------------------------------*/
#ifndef __XXX_XX_H
#define __XXX_XX_H

/* just for C/C++ Hybrid Programming*/
#ifdef __cplusplus
extern "C" {
#endif

/* Includes ------------------------------------------------------------------*/
#include <math.h>       // 引用标准库的头文件
…
#include “myheader.h”   // 引用非标准库的头文件
/* Private types -------------------------------------------------------------*/
class Box               // 类结构声明
{
…
};

/* Exported types ------------------------------------------------------------*/
/* Exported constants --------------------------------------------------------*/
/* Exported variables --------------------------------------------------------*/
/* Exported macro ------------------------------------------------------------*/

/* Exported functions --------------------------------------------------------*/
void Function1(…);  // 全局函数声明

#ifdef __cplusplus
}
#endif  /* __cplusplus */
 
#endif /* __XXX_XX_H */


 

…

…

#endif


/**
  *
  * @brief     Configures the discontinuous mode for theselected ADC regular group channel.
  * @param    ADCx:where x can be 1, 2 or 3 to select the ADC peripheral.
  * @param    Number:specifies the discontinuous mode regular channel count value. This number must be between 1 and8.
  * @retval    None
  * @par      Usage：
  *           ADC_DiscModeChannelCountConfig(ADC1,6);<br>
  * @par      Tag:
  *           此函数不能在中断里调用。
  * 
*/
void ADC_DiscModeChannelCountConfig(ADC_TypeDef* ADCx, INT8U_tNumber);

```

### 源文件

```c++
/**
  ******************************************************************************
  * @file              :Air_pressure.c
  * @Author            :LonlyPan
  * @brief             :Air pressure process and control
  ******************************************************************************
  * @attention
  *
  * <h2><center>© Copyright (c) 2019 STMicroelectronics.
  * All rights reserved.</center></h2>
  *
  * This software component is licensed by ST under BSD 3-Clause license,
  * the "License"; You may not use this file except in compliance with the
  * License. You may obtain a copy of the License at:
  *                        opensource.org/licenses/BSD-3-Clause
  *
  ******************************************************************************
  */
  
  
#ifdef __cplusplus
extern "C" {
#endif

/* Includes ------------------------------------------------------------------*/

/* Private types -------------------------------------------------------------*/
/* Private constants ---------------------------------------------------------*/
/* Private variables ---------------------------------------------------------*/
structINNO_HIF_PlatfromFuncs * g_client_funs;  /**< file attribute */ 
/* Private macros ------------------------------------------------------------*/

/* Private function prototypes -----------------------------------------------*/

/* User code -----------------------------------------------------------------*/

#ifdef __cplusplus
}
#endif  /* __cplusplus */

```

### 函数

```c 
/**
  * @brief Configures the discontinuousmode for the selected ADC regular group channel.
  * @param ADCx: where x can be 1, 2 or 3 toselect the ADC peripheral.
  * @param  Number: specifies the discontinuousmode regular channel  count value. This number must bebetween 1 and 8.
  * @retval None
  * @par   Modification:修改了********<br>
  *                       History
  *          Modified by：***<br>
  *           Date： 2013-10-10
  *          Modification:修改了********<br>
  * 注意注释内容对齐，最少空一格，注释语句首字大写。多个参数另起一行写。
  */
void * strcpy(char *dest,const char *src);  // 指针仅作输入用，加const
{
    赋值语句*********;     /**< file attribute */ 
    语句***********;        /**< file attribute */ 
    语句*******;             /**< file attribute */ 
}
```

### 常见单词缩写表

|单词|缩写|单词|缩写|
|------------|-----------|--------|----------------|
|  argument  |  arg  | buffer   | 	buf   |
| clock | 	clk  | command  | 	cmd   |
|  comparet  |  cmp  | configuration   | 	cfg   |
|  device |  dev  |  error  | 	err  |
|  hexadecimal  |  	hex  | increment  | 	inc  |
|  initialize  |  init  | 	maximum  | 	max   |
|  message  |  msg  | 	minimum  | min   |
|  parameter  |  param  | 	previous  | 	prev   |
|  register  |  reg  | 	semaphore  | 	sem   |
|  statistic  |  stat  | 	synchronize  | 	syn  |
|  temp  |  tmp  | 	  | 	   |


## 参考文档

1、[编码规范](https://liteos.github.io/quick-start/contrb/code-standard.html#注释)
2、[【读书笔记】-《华为-C语言编程规范》](https://blog.csdn.net/sishuihuahua/article/details/83052267)
3、[高质量C++/C编程指南](https://www.jianshu.com/p/654fea4bfd4f)
4、[嵌入式C语言编程规范（个人规约）](https://blog.csdn.net/zhanglianpin/article/details/46544431)
5、[Google 开源项目风格指南 (中文版)](https://zh-google-styleguide.readthedocs.io/en/latest/)


