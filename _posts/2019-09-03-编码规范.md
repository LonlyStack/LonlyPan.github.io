---
layout: post
title: "编码规范"
data: 2019-9-3 15:15
categories:  办公
---

**未经授权，不得全文转载。转载前请先阅读[本站版权声明](https://lonlypan.com/archivers/版权声明)**

## 自己需要改正的地方

* 查看—**编写示例**
* 在首次使用前初始化变量
* unix like风格，单词小写，用下划线连接，
* 建议使用"/*...*/"进行注释，多行单行都适用
* 全局变量应增加”g_“前缀；静态增加”s_“前缀；类型名加前缀”P_“，全大写
* 数值和字符串等等常量的定义，建议采用全大写字母，使用下划线”\_“连接
* 定义函数时左花括号”{“单独占一行，其他的`if`、`while`、`for`等语句建议紧随其后
* 组成switch、while、do...while 或for 结构体的语句应该是复合语句。即使该复合语句只包含一条语句也要扩在{}里
* const、virtual、inline、case 等关键字之后至少要留一个空格；函数名之后不要留空格，紧跟左括号‘（’，以与关键字区别
* 二元操作符：“=”、“+=” “>=”、“<=”、“+”、“\*”、“%”、“&&”、“\|\|”、“<<”,“^”等的前后应加空格
* 一元操作符：“!”、“~”、“++”、“--”、“&”（地址运算符）等前后不加空格

## 总体原则
* 清晰，易于维护、易于重构
* 简洁，易于理解，并且易于实现
* 风格统一，代码整体风格保持统一
* 通用性，遵循业界通用的编程规范

## 目录结构
**建议将工程按照功能模块划分子目录（lcdmenu，usart，motor......），子目录再定义头文件和源文件目录**



## 排版格式
* 程序块采用缩进风格编写，**每级缩进为4格空格,不要使用tab键**
* **相对独立的程序块之间、变量说明之后必须加空行**
* 一条语句不能过长 如必能拆分需要分行写
* 一行只写一条语句
* if、for、do、while、case、switch、default等语句独占一行
* 源程序中关系较为紧密的代码尽可能相邻
* 注释符(包括„/*‟„//‟„*/‟)与注释内容之间要用一个空格进行分隔
* **定义函数时左花括号”{“单独占一行，其他的`if`、`while`、`for`等语句建议紧随其后**
* **组成switch、while、do...while 或for 结构体的语句应该是复合语句。即使该复合语句只包含一条语句也要扩在{}里**
* **const、virtual、inline、case 等关键字之后至少要留一个空格；函数名之后不要留空格，紧跟左括号‘（’，以与关键字区别**
* **二元操作符：“=”、“+=” “>=”、“<=”、“+”、“\*”、“%”、“&&”、“\|\|”、“<<”,“^”等的前后应加空格**
* **一元操作符：“!”、“~”、“++”、“--”、“&”（地址运算符）等前后不加空格**

* 建议函数内部变量定义和函数语句之间空三行

## 注释
* 注释风格要统一，注释内容要清楚、明了、含义准确、防止注释二义性
* 在代码的功能、意图层次上进行注释，即**注释解释代码难以表达的意图，而不是仅仅重复描述代码**
* **函数声明处注释函数的功能、性能即用法，包括输入输出函数、函数返回值、可重入的要求等；定义处详细描述函数功能和实现要点，如实现的简要步骤、实现的理由、设计约束等**
* **对于函数名能够自解释的，可以不写注释。**
* **全局变量要有详细的注释，包括对其功能、取值范围以及存取时注意事项等的说明**
* **注释应放在起代码上方相邻位置或右方**
* 避免在注释中使用缩写，除非是业界通用或子系统内标准化的缩写
* **文件头部要注释，建议注释列出：版权说明、版本号、生成日期、作者姓名、功能说明、与其他文件的关系、修改日志等，头文件的注释还应有函数功能的简要说明。**
* 在程序块的结束行右方加注释标记，以表明某程序块的结束。
* 建议使用"/*...*/"进行注释，多行单行都适用

## 头文件
### 设计原则
* 为了防止头文件被重复引用，应当用ifndef/define/endif结构产生预处理块
* 用 #include <filename.h> 格式来引用标准库的头文件，用 #include “filename.h” 引用非标准库的头文件。标准库引用声明在前。
* 头文件应当职责单一
* **头文件中适合放置接口的声明，不适合放置实现**
* **不要在头文件中定义变量**
* 建议每一个.c文件应有一个同名.h文件，用于声明需要对外公开的接口
* **一个模块通常包含多个.c文件，建议放在同一个目录下，目录名即为模块名；如果一个模块包含多个子模块，则建议每一个子模块提供一个对外的.h，文件名为子模块名**
* 禁止循环依赖
* 禁止包含用不到的头文件
* 只能通过.h使用extern
* 禁止在extern "C" 包含头文件

### 版权声明
* 头文件版权声明一致，放在头文件置顶位置
* 如果提交的代码是在开源软件基础上修改所编写或衍生的代码，请遵循开源许可协议要求，并且已完成履行被修改软件的许可证义务
* 测试版本号命名”0“开头 V0.x   正式版本非”0“开头  V1.x，版本重大更新才更改开头数字

## 标识符
* **unix like风格，单词小写，用下划线连接，例如：text_mutex。全局变量大小写混合方式，例如：GetErrMsg**
* 不使用缩写和汉语拼音
* 避免名字中出现数字编号
* 不建议使用匈牙利命名法
* 标识符前不应添加模块、项目、产品、部门的名称作为前缀
* 类型名加前缀”P_“，全大写，下划线连接


## 常量
- 函数和变量使用所有大写字母命名：[A-Z]和[0-9]
- 下划线“ \_”用于将函数和变量名称拆分为更多逻辑组
- 由表达式构成的常量必须在整个表达式周围带有花括号； 单值常量忽略该条
- 必须始终定义和使用常量，而不要使用代码中的“ magic numbers”
- 无符号整数常量（包括十六进制值）的定义必须使用 ‘u’ 后缀 
- 对于十六进制值，请使用大写字母A-F 
- 规则也适用于枚举，因为它们也是常量
- 不要在常量定义中包括强制类型转换类型 

**举例：**

```c 
#define BUFFER_SIZE 512 
#define NUM_X_PINS (24u) 
#define XEDGEGRADIENT_MASK (0x3Fu) 
#define NUM_MATRIX_PINS (NUM_X_PINS + NUM_Y_PINS)
enum buffer_size = {
          BUFFER_SIZE_A = 128, 
          BUFFER_SIZE_B = 512, 
};
```

## 宏
* 所有的宏参数以及宏定义本身都必须用括号括起来 
* **除了头文件或编译开关等特殊表示定义，宏定义不能使用下划线”_“开头和结尾**
* 除非必要，应尽可能使用函数代替宏,除了do-while 结构
* **常量建议使用const代替宏**
* 像宏这样的函数遵循与函数和变量相同的命名规则。 这样，在以后的阶段就更容易将它们交换为内联函数
* 像宏之类的函数绝不能多次访问其参数 
* 如果可能，应避免使用类似宏的函数，而应使用静态内联函数
* 函数宏不得从其 “宿主” 调用函数中引用局部变量，而可以使用全局变量或传递给它们的参数

**举例：**

```c 
#define set_io(id) do {              \ 
           PORTA |= (1 << (id));     \ 
} while (0)
```

## 变量
- 函数和变量使用所有小写字母命名：[a-z]和[0-9]
- 下划线“ \_”用于将函数和变量名称拆分为更多逻辑组
- 禁止单字节变量，除局部循环使用
-  **全局变量应增加”g_“前缀，静态增加”s_“前缀**
* **一个变量只有一个功能，不要把一个变量用作多种用途**
* 防止局部变量和全局变量同名
* **不用或者少用全局变量**
* **在首次使用前初始化变量**
* **使用面向接口编程思想，通过API访问数据；若本模块数据需要对外开放，应提供接口函数来设置、获取**
* 初始化变量离使用地方越近越好
* 明确全局变量初始化顺序
* **尽量减少没有必要的数据类型默认转换与强制转换**
* **避免使用 BOOL 参数和NULL**

**举例：**

```c 
void this_is_a_function_prototype(void);
```

## 全局变量

- 全局变量应增加”g_“前缀
- 全局变量要有较详细的注释，包括对其功能、取值范围、哪些函数或过程存取它以及
存取时注意事项等的说明。

**举例：**

```c 
/* @brif The ErrorCode when SCCP translate */
/* @value Global Title failure, as follows */ // 变量作用、含义
/* 0 － SUCCESS 1 － GT Table error */
/* 2 － GT error Others － no use */ // 变量取值范围
/* only function SCCPTranslate() in */
/* this modual can modify it, and other */
/* module can visit it through call */
/* the function GetGTTransErrorCode() */ // 使用方法
BYTE g_GTTranErrorCode;
```

## 类型定义
- 如果可用，必须使用stdint.h和stdbool.h类型 
- 类型定义使用所有小写字母命名：[a-z]和[0-9] 
- 下划线“ \_”用于将函数和变量名称拆分为更多逻辑组
- 类型名加前缀”p_“

**举例：**

```c 
typedef uint8_t p_buffer_item;
```

## 函数
- 函数和变量使用所有小写字母命名：[a-z]和[0-9]
- 下划线“ \_”用于将函数和变量名称拆分为更多逻辑组
* **重复代码应该尽可能提炼成函数**
* 避免函数过长，**新增函数不超过40-50行**
* 避免函数的代码块嵌套过深
* **函数应避免使用全局变量、静态局部变量和 I/O 操作，不可避免的地方应集中使用**
* 设计高扇入，合理扇出（小于7）的函数
* **函数不变参数使用const**
* 函数参数不超过5个
* **除打印类函数外，不要使用可变长参函数**
* **在源文件范围内声明和定义的所有函数，除非外部可见 ，都应增加static关键字**
* **不建议使用递归函数调用**
* 用正确的反义词组命名具有互斥意义的变量或相反动作的函数等
* 在多重循环中，应将最忙的循环放在最内层
* **函数名大写开头**

**举例：**

```c 
void this_is_a_function_prototype(void);
```

## 可移植性
* 不使用与硬件或操作系统关系很大的语句，而使用建议的标准语句，以提高软件的可移植性和可重用性

## 编写示例

### 注释缩写
```c
@file              文件名
@author            作者
@brief             简要说明
@param             用于函数说明中，后面接参数名字，然后再接关于该参数的说明
@return            对函数返回值进行说明
@note              注解信息
@attention         注意信息
@warning           警告信息
@see               表示交叉参考
```



### 常见单词缩写表

|单词|缩写|单词|缩写|
|------------|-----------|--------|----------------|
|  argument  |  arg  | buffer   | 	buf   |
| clock | 	clk  | command  | 	cmd   |
|  comparet  |  cmp  | configuration   | 	cfg   |
|  device |  dev  |  error  | 	err  |
|  hexadecimal  |  	hex  | increment  | 	inc  |
|  initialize  |  init  | 	maximum  | 	max   |
|  message  |  msg  | 	minimum  | min   |
|  parameter  |  param  | 	previous  | 	prev   |
|  register  |  reg  | 	semaphore  | 	sem   |
|  statistic  |  stat  | 	synchronize  | 	syn  |
|  temp  |  tmp  | 	  | 	   |

### 反义词组

|    |    |     |
|--------------------|----------------|-------------------------|
|  add / remove  | begin/end  |  create / destroy  |
|  insert / delete  |  first / last  |  get / release  |
|  increment / decrement  |  put / get  |
|  add / delete  |  lock / unlock  |  open / close  |
|  min / max  |  old / new  |  start / stop  |
|  next / previous  |  source / target  |  show / hide  |
|  send / receive  |  source / destination  |
|  cut / paste  |  up / down  |

示例：  
int min_sum;  
int max_sum;  
int add_user( BYTE \*user_name );  
int delete_user( BYTE \*user_name );  

### 函数

```c 
/**
  * @brief     xxx
  * @note
  * @param(in) xxx
  * @param(out) xxx
  * @retval     xxx
  * @par   Modification:
  *        History:
  *          Version:
  *          Author:
  *          date:
  *          Modification:
  */
void * strcpy(char *dest,const char *src);  // 指针仅作输入用，加const
{
    赋值语句*********;  /* file attribute 不建议使用 “//xxx”*/ 
    语句***********;  /* file attribute */ 
    语句*******;  /* file attribute */ 
}
```

### 头文件

```c
/**
  * Copyright (c) 2019,LonlyPan
  * All rights reserved.
  *
  * @file    lcdmenu.c
  * @brief   Header file of xxx module
  * @author  LonlyPan
  * @version  V0.1
  * @date    2019-09-04
  *
  * @par     Modification:
  *        History:
  *          Version:
  *          Author:
  *          date:
  *          Modification:
  *         
  *
  * @attention
  */
/* Define to prevent recursive inclusion -------------------------------------*/
#ifndef __XXX_XX_H
#define __XXX_XX_H

/* just for C/C++ Hybrid Programming*/
#ifdef __cplusplus
extern "C" {
#endif



/* Includes ------------------------------------------------------------------*/
#include <math.h>       // 引用标准库的头文件
...
#include “myheader.h”   // 引用非标准库的头文件
/* Private types -------------------------------------------------------------*/
class Box               // 类结构声明
{
...
};
/* Private constants ---------------------------------------------------------*/
#define xxx xx
/* Private macros ------------------------------------------------------------*/
#if defined(xxx)
...
#endif  /* xxx */
/* Exported types ------------------------------------------------------------*/
/* Exported constants --------------------------------------------------------*/
/* Exported variables --------------------------------------------------------*/
/* Exported macro ------------------------------------------------------------*/

/* Exported functions prototypes --------------------------------------------------------*/



void Function1(void)
{
    ...
}



#ifdef __cplusplus
}
#endif  /* __cplusplus */
 
#endif /* __XXX_XX_H */
```

### 源文件

```c++
/**
  * Copyright (c) 2019,LonlyPan
  * All rights reserved.
  *
  * @file    lcdmenu.c
  * @brief   Screen interface display,data refresh and key value acquisition
  * @author  LonlyPan
  * @version  V0.1
  * @date    2019-09-04
  *
  * @par     Modification:
  *        History:
  *          Version:
  *          Author:
  *          date:
  *          Modification:
  *         
  *
  * @attention
  */
/* Includes ------------------------------------------------------------------*/
/* Private types -------------------------------------------------------------*/
/* Private constants ---------------------------------------------------------*/
/* Private variables ---------------------------------------------------------*/
/* Private macros ------------------------------------------------------------*/
#if defined(xxx)
...
#endif  /* xxx */
/* Private function prototypes------------------------------------------------*/

/* Exported types ------------------------------------------------------------*/
/* Exported constants --------------------------------------------------------*/
/* Exported variables --------------------------------------------------------*/
/* Exported macro ------------------------------------------------------------*/

/* Exported functions prototypes --------------------------------------------------------*/
/* User code------------------------------------------------------------------*/



void Function1(void)
{
    ...
}



#ifdef __cplusplus
}
#endif  /* __cplusplus */
```

## 参考文档

1、[编码规范](https://liteos.github.io/quick-start/contrb/code-standard.html#注释)  
2、[【读书笔记】-《华为-C语言编程规范》](https://blog.csdn.net/sishuihuahua/article/details/83052267)  
3、[高质量C++/C编程指南](https://www.jianshu.com/p/654fea4bfd4f)  
4、[嵌入式C语言编程规范（个人规约）](https://blog.csdn.net/zhanglianpin/article/details/46544431)  
5、[Google 开源项目风格指南 (中文版)](https://zh-google-styleguide.readthedocs.io/en/latest/)  
